<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI-Driven Portfolio Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const App = () => {
        const [name, setName] = React.useState("");
        const [email, setEmail] = React.useState("");
        const [skills, setSkills] = React.useState("");
        const [projects, setProjects] = React.useState("");
        const [portfolio, setPortfolio] = React.useState("");
        const [loading, setLoading] = React.useState(false);
        const [portfolioLink, setPortfolioLink] = React.useState("");

        const handleSubmit = async (e) => {
          e.preventDefault();
          setLoading(true);
          try {
            const response = await fetch("/generate-portfolio", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, email, skills, projects }),
            });
            const data = await response.json();

            let cleaned = data.portfolio
              .replace(/^```html\s*/, "")
              .replace(/```$/, "")
              .trim();
            const blob = new Blob([cleaned], { type: "text/html" });
            const fileURL = URL.createObjectURL(blob);
            setPortfolioLink(fileURL);
            setPortfolio(cleaned);
          } catch (error) {
            console.error("Error:", error);
            setPortfolio("Error generating portfolio. Please try again.");
          }
          setLoading(false);
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4">
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 shadow-xl max-w-2xl w-full">
              <h1 className="text-3xl font-bold text-white text-center mb-6">
                AI Portfolio Generator
              </h1>
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <label className="block text-white mb-2">Name</label>
                  <input
                    type="text"
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                    className="w-full p-2 rounded-lg bg-white/20 text-white placeholder-gray-300"
                    placeholder="e.g., John Doe"
                    required
                  />
                </div>
                <div>
                  <label className="block text-white mb-2">Email</label>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full p-2 rounded-lg bg-white/20 text-white placeholder-gray-300"
                    placeholder="e.g., john@example.com"
                    required
                  />
                </div>
                <div>
                  <label className="block text-white mb-2">
                    Skills (comma-separated)
                  </label>
                  <input
                    type="text"
                    value={skills}
                    onChange={(e) => setSkills(e.target.value)}
                    className="w-full p-2 rounded-lg bg-white/20 text-white placeholder-gray-300"
                    placeholder="e.g., JavaScript, Python, React"
                  />
                </div>
                <div>
                  <label className="block text-white mb-2">
                    Projects (brief description)
                  </label>
                  <textarea
                    value={projects}
                    onChange={(e) => setProjects(e.target.value)}
                    className="w-full p-2 rounded-lg bg-white/20 text-white placeholder-gray-300"
                    placeholder="e.g., Built a task manager with React and Node.js"
                  />
                </div>
                <button
                  type="submit"
                  className="w-full bg-indigo-700 text-white py-2 rounded-lg hover:bg-indigo-800 transition-all"
                  disabled={loading}
                >
                  {loading ? "Generating..." : "Generate Portfolio"}
                </button>
              </form>
              {portfolio && (
                <div className="mt-6 p-4 bg-white/10 rounded-lg text-white">
                  <h2 className="text-xl font-semibold mb-2">
                    Generated Portfolio
                  </h2>
                  <a
                    href={portfolioLink}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="block bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-4 rounded-lg mt-2"
                  >
                    Open Portfolio in New Tab
                  </a>
                </div>
              )}
            </div>
          </div>
        );
      };

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
